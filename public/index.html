<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>LAN Video Server</title>
    <script src="https://unpkg.com/lucide@0.294.0/dist/umd/lucide.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --sp-3: 3px;
        --sp-5: 5px;
        --sp-8: 8px;
        --sp-13: 13px;
        --sp-21: 21px;
        --sp-34: 34px;
        --sp-55: 55px;
        --sp-89: 89px;
        --black: #0a0a0a;
        --white: #fafafa;
        --gray-100: #f5f5f5;
        --gray-200: #e5e5e5;
        --gray-300: #d4d4d4;
        --gray-400: #a3a3a3;
        --gray-500: #737373;
        --gray-600: #525252;
        --gray-700: #404040;
        --gray-800: #262626;
        --gray-900: #171717;
        --accent: #ff3b30;
        --accent-hover: #ff453a;
        --success: #30d158;
        --text-xs: 11px;
        --text-sm: 13px;
        --text-base: 16px;
        --text-lg: 21px;
        --text-2xl: 34px;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          "Inter",
          -apple-system,
          sans-serif;
        background: var(--black);
        color: var(--white);
        min-height: 100vh;
        line-height: 1.618;
        -webkit-font-smoothing: antialiased;
      }
      .container {
        max-width: 987px;
        margin: 0 auto;
        padding: var(--sp-34) var(--sp-21);
      }

      /* Header */
      .header {
        display: flex;
        align-items: center;
        gap: var(--sp-21);
        margin-bottom: var(--sp-55);
        padding-bottom: var(--sp-21);
        border-bottom: 1px solid var(--gray-800);
      }
      .logo {
        width: var(--sp-55);
        height: var(--sp-55);
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--accent);
      }
      .logo i {
        width: var(--sp-34);
        height: var(--sp-34);
        color: var(--white);
      }
      .header-text h1 {
        font-size: var(--text-2xl);
        font-weight: 600;
        letter-spacing: -0.02em;
      }
      .header-text p {
        font-size: var(--text-sm);
        color: var(--gray-400);
      }

      /* Main input area */
      .main-input {
        position: relative;
        margin-bottom: var(--sp-21);
      }
      .main-input input {
        width: 100%;
        padding: var(--sp-21) var(--sp-21) var(--sp-21) var(--sp-55);
        font-size: var(--text-lg);
        font-family: inherit;
        background: var(--gray-900);
        border: 2px solid var(--gray-700);
        color: var(--white);
        transition: all 0.2s;
      }
      .main-input input:focus {
        outline: none;
        border-color: var(--accent);
      }
      .main-input input::placeholder {
        color: var(--gray-600);
      }
      .main-input .input-icon {
        position: absolute;
        left: var(--sp-21);
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-500);
      }
      .main-input .input-icon i {
        width: var(--sp-21);
        height: var(--sp-21);
      }

      /* Detection hint */
      .detect-hint {
        display: flex;
        align-items: center;
        gap: var(--sp-8);
        padding: var(--sp-8) var(--sp-13);
        background: var(--gray-800);
        font-size: var(--text-sm);
        color: var(--gray-400);
        margin-bottom: var(--sp-21);
        min-height: 36px;
      }
      .detect-hint i {
        width: 16px;
        height: 16px;
      }
      .detect-hint.ready {
        color: var(--success);
      }
      .detect-hint .site-badge {
        background: var(--gray-700);
        padding: 2px 8px;
        font-size: var(--text-xs);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      /* Action button */
      .send-btn {
        width: 100%;
        padding: var(--sp-21);
        font-size: var(--text-base);
        font-weight: 600;
        font-family: inherit;
        background: var(--accent);
        color: var(--white);
        border: none;
        cursor: pointer;
        transition: background 0.15s;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--sp-8);
      }
      .send-btn:hover {
        background: var(--accent-hover);
      }
      .send-btn:disabled {
        background: var(--gray-700);
        cursor: not-allowed;
      }
      .send-btn i {
        width: var(--sp-21);
        height: var(--sp-21);
      }

      /* Secondary actions */
      .secondary-actions {
        display: flex;
        gap: var(--sp-8);
        margin-top: var(--sp-13);
      }
      .sec-btn {
        flex: 1;
        padding: var(--sp-13);
        font-size: var(--text-sm);
        font-family: inherit;
        background: transparent;
        color: var(--gray-400);
        border: 1px solid var(--gray-700);
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--sp-5);
      }
      .sec-btn:hover {
        color: var(--white);
        border-color: var(--white);
      }
      .sec-btn i {
        width: 14px;
        height: 14px;
      }

      /* TV status card */
      .tv-card {
        display: flex;
        align-items: center;
        gap: var(--sp-21);
        padding: var(--sp-21);
        background: var(--gray-900);
        border: 1px solid var(--gray-800);
        margin-bottom: var(--sp-34);
      }
      .tv-icon {
        width: var(--sp-55);
        height: var(--sp-55);
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--gray-800);
      }
      .tv-icon i {
        width: var(--sp-21);
        height: var(--sp-21);
      }
      .tv-info {
        flex: 1;
      }
      .tv-info h3 {
        font-size: var(--text-base);
        font-weight: 500;
        margin-bottom: 2px;
      }
      .tv-info p {
        font-size: var(--text-sm);
        color: var(--gray-400);
      }
      .tv-info a {
        color: var(--white);
        text-decoration: underline;
        text-underline-offset: 3px;
      }
      .tv-count {
        font-size: var(--text-2xl);
        font-weight: 600;
        color: var(--success);
      }
      .tv-count.zero {
        color: var(--gray-600);
      }

      /* QR Code */
      .qr-section {
        text-align: center;
        padding: var(--sp-21);
        background: var(--white);
        margin-bottom: var(--sp-34);
      }
      .qr-section canvas {
        display: block;
        margin: 0 auto;
      }
      .qr-label {
        margin-top: var(--sp-8);
        font-size: var(--text-xs);
        color: var(--black);
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      /* History */
      .history {
        margin-top: var(--sp-55);
      }
      .history-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--sp-13);
      }
      .history-title {
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--gray-400);
      }
      .history-clear {
        font-size: var(--text-xs);
        color: var(--gray-600);
        background: none;
        border: none;
        cursor: pointer;
      }
      .history-clear:hover {
        color: var(--white);
      }
      .history-list {
        display: flex;
        flex-direction: column;
        gap: var(--sp-3);
      }
      .history-item {
        display: flex;
        align-items: center;
        gap: var(--sp-13);
        padding: var(--sp-13);
        background: var(--gray-900);
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.15s;
      }
      .history-item:hover {
        border-color: var(--gray-700);
      }
      .history-item i {
        width: 16px;
        height: 16px;
        color: var(--gray-500);
        flex-shrink: 0;
      }
      .history-item .title {
        flex: 1;
        font-size: var(--text-sm);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .history-item .site {
        font-size: var(--text-xs);
        color: var(--gray-600);
        text-transform: uppercase;
      }
      .history-item .delete {
        opacity: 0;
        color: var(--gray-600);
        background: none;
        border: none;
        cursor: pointer;
        padding: 4px;
      }
      .history-item:hover .delete {
        opacity: 1;
      }
      .history-item .delete:hover {
        color: var(--accent);
      }

      /* Preview */
      .preview {
        margin-top: var(--sp-34);
      }
      .preview-title {
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--gray-400);
        margin-bottom: var(--sp-13);
      }
      .preview-container {
        aspect-ratio: 16/9;
        background: var(--gray-900);
        border: 1px solid var(--gray-800);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .preview-container video,
      .preview-container iframe,
      .preview-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
      .preview-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--sp-8);
        color: var(--gray-600);
      }
      .preview-placeholder i {
        width: var(--sp-34);
        height: var(--sp-34);
      }

      /* Status */
      .status {
        margin-top: var(--sp-13);
        padding: var(--sp-13);
        background: var(--gray-900);
        border-left: 2px solid var(--gray-700);
        font-size: var(--text-sm);
        color: var(--gray-400);
      }
      .status.success {
        border-color: var(--success);
      }
      .status.error {
        border-color: var(--accent);
      }

      /* Drop zone */
      .drop-zone {
        position: fixed;
        inset: 0;
        background: rgba(10, 10, 10, 0.95);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .drop-zone.active {
        display: flex;
      }
      .drop-zone-inner {
        border: 2px dashed var(--gray-600);
        padding: var(--sp-89);
        text-align: center;
      }
      .drop-zone-inner i {
        width: var(--sp-55);
        height: var(--sp-55);
        color: var(--gray-400);
        margin-bottom: var(--sp-21);
      }
      .drop-zone-inner p {
        font-size: var(--text-lg);
        color: var(--gray-400);
      }

      /* Bookmarklet */
      .bookmarklet {
        margin-top: var(--sp-34);
        padding: var(--sp-21);
        background: var(--gray-900);
        border: 1px solid var(--gray-800);
      }
      .bookmarklet-title {
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--gray-400);
        margin-bottom: var(--sp-8);
      }
      .bookmarklet-link {
        display: inline-block;
        padding: var(--sp-8) var(--sp-13);
        background: var(--gray-800);
        color: var(--white);
        text-decoration: none;
        font-size: var(--text-sm);
        border: 1px dashed var(--gray-600);
      }
      .bookmarklet-hint {
        font-size: var(--text-xs);
        color: var(--gray-600);
        margin-top: var(--sp-8);
      }

      /* Footer */
      .footer {
        margin-top: var(--sp-89);
        padding-top: var(--sp-21);
        border-top: 1px solid var(--gray-800);
        display: flex;
        justify-content: space-between;
        font-size: var(--text-xs);
        color: var(--gray-600);
      }

      @media (max-width: 610px) {
        .tv-card {
          flex-direction: column;
          text-align: center;
        }
        .secondary-actions {
          flex-wrap: wrap;
        }
      }
    </style>
  </head>
  <body>
    <div class="drop-zone" id="dropZone">
      <div class="drop-zone-inner">
        <i data-lucide="download"></i>
        <p>Drop .torrent file here</p>
      </div>
    </div>

    <div class="container">
      <header class="header">
        <div class="logo"><i data-lucide="play"></i></div>
        <div class="header-text">
          <h1>LAN Video</h1>
          <p>Any URL → TV</p>
        </div>
      </header>

      <!-- TV Status -->
      <div class="tv-card">
        <div class="tv-icon"><i data-lucide="tv"></i></div>
        <div class="tv-info">
          <h3>Television</h3>
          <p>Open <a href="/tv.html" id="tvLink">/tv.html</a> on your TV</p>
        </div>
        <div class="tv-count zero" id="tvCount">0</div>
      </div>

      <!-- QR Code for TV -->
      <div class="qr-section" id="qrSection">
        <canvas id="qrCanvas"></canvas>
        <div class="qr-label">Scan to open TV page</div>
      </div>

      <!-- Main Input -->
      <div class="main-input">
        <span class="input-icon"
          ><i data-lucide="link" id="inputIcon"></i
        ></span>
        <input
          type="text"
          id="url"
          placeholder="Paste any URL — YouTube, TikTok, torrent, video..."
          autocomplete="off"
        />
      </div>

      <!-- Detection hint -->
      <div class="detect-hint" id="detectHint">
        <i data-lucide="info"></i>
        <span id="detectText">Paste a URL to detect type</span>
      </div>

      <!-- Send button -->
      <button class="send-btn" id="sendBtn" disabled>
        <i data-lucide="send"></i>
        <span>Send to TV</span>
      </button>

      <!-- Secondary actions -->
      <div class="secondary-actions">
        <button class="sec-btn" id="playHereBtn">
          <i data-lucide="play"></i> Play here
        </button>
        <button class="sec-btn" id="copyLinkBtn">
          <i data-lucide="link"></i> Copy link
        </button>
        <button class="sec-btn" id="clearTvBtn">
          <i data-lucide="x"></i> Clear TV
        </button>
      </div>

      <!-- Status -->
      <div class="status" id="status">Ready</div>

      <!-- Preview -->
      <div class="preview">
        <div class="preview-title">Preview</div>
        <div class="preview-container" id="preview">
          <div class="preview-placeholder">
            <i data-lucide="film"></i>
            <span>No media</span>
          </div>
        </div>
      </div>

      <!-- History -->
      <div class="history" id="historySection">
        <div class="history-header">
          <span class="history-title">Recent</span>
          <button class="history-clear" id="clearHistory">Clear all</button>
        </div>
        <div class="history-list" id="historyList"></div>
      </div>

      <!-- Bookmarklet -->
      <div class="bookmarklet">
        <div class="bookmarklet-title">Bookmarklet</div>
        <a class="bookmarklet-link" id="bookmarklet" href="#">→ Send to TV</a>
        <div class="bookmarklet-hint">
          Drag this to your bookmarks bar. Click it on any page with video.
        </div>
      </div>

      <footer class="footer">
        <span>LAN Video Server</span>
        <span id="serverInfo"></span>
      </footer>
    </div>

    <!-- QR Code library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <script>
      lucide.createIcons();

      const $ = (id) => document.getElementById(id);
      const urlInput = $("url");
      const sendBtn = $("sendBtn");
      const detectHint = $("detectHint");
      const detectText = $("detectText");
      const inputIcon = $("inputIcon");
      const status = $("status");
      const preview = $("preview");
      const tvCount = $("tvCount");
      const historyList = $("historyList");
      const dropZone = $("dropZone");

      // Server info
      $("serverInfo").textContent = location.host;
      $("tvLink").href = `http://${location.host}/tv.html`;

      // Generate QR code for TV page
      const tvUrl = `http://${location.host}/tv.html`;
      if (typeof QRCode !== "undefined") {
        QRCode.toCanvas($("qrCanvas"), tvUrl, {
          width: 144,
          margin: 1,
          color: { dark: "#0a0a0a", light: "#fafafa" },
        });
      }

      // Bookmarklet
      const bookmarkletCode = `javascript:(function(){var s=document.location.href;fetch('http://${location.host}/api/url2hls',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:s})}).then(r=>r.json()).then(d=>{if(d.streamUrl){fetch('http://${location.host}/tv/push',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:d.streamUrl})}).then(()=>alert('Sent to TV: '+d.name)).catch(e=>alert('Error: '+e))}else{fetch('http://${location.host}/tv/push',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:s})}).then(()=>alert('Sent to TV')).catch(e=>alert('Error: '+e))}}).catch(()=>{fetch('http://${location.host}/tv/push',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:s})}).then(()=>alert('Sent to TV'))})})();`;
      $("bookmarklet").href = bookmarkletCode;

      // History management
      function getHistory() {
        try {
          return JSON.parse(localStorage.getItem("lanvideo_history") || "[]");
        } catch {
          return [];
        }
      }
      function saveHistory(items) {
        localStorage.setItem(
          "lanvideo_history",
          JSON.stringify(items.slice(0, 20)),
        );
      }
      function addToHistory(url, title, site, icon) {
        const history = getHistory().filter((h) => h.url !== url);
        history.unshift({
          url,
          title: title || url,
          site: site || "",
          icon: icon || "link",
          time: Date.now(),
        });
        saveHistory(history);
        renderHistory();
      }
      function renderHistory() {
        const history = getHistory();
        if (history.length === 0) {
          $("historySection").style.display = "none";
          return;
        }
        $("historySection").style.display = "block";
        historyList.innerHTML = history
          .map(
            (h, i) => `
        <div class="history-item" data-url="${encodeURIComponent(h.url)}">
          <i data-lucide="${h.icon || "link"}"></i>
          <span class="title">${h.title}</span>
          ${h.site ? `<span class="site">${h.site}</span>` : ""}
          <button class="delete" data-idx="${i}"><i data-lucide="x"></i></button>
        </div>
      `,
          )
          .join("");
        lucide.createIcons();

        historyList.querySelectorAll(".history-item").forEach((el) => {
          el.addEventListener("click", (e) => {
            if (e.target.closest(".delete")) return;
            urlInput.value = decodeURIComponent(el.dataset.url);
            urlInput.dispatchEvent(new Event("input"));
          });
        });
        historyList.querySelectorAll(".delete").forEach((el) => {
          el.addEventListener("click", (e) => {
            e.stopPropagation();
            const history = getHistory();
            history.splice(parseInt(el.dataset.idx), 1);
            saveHistory(history);
            renderHistory();
          });
        });
      }
      $("clearHistory").addEventListener("click", () => {
        saveHistory([]);
        renderHistory();
      });
      renderHistory();

      // TV count polling
      async function updateTvCount() {
        try {
          const r = await fetch("/tv/clients");
          const d = await r.json();
          tvCount.textContent = d.clients || 0;
          tvCount.classList.toggle("zero", d.clients === 0);
        } catch {}
      }
      setInterval(updateTvCount, 3000);
      updateTvCount();

      // URL detection with debounce
      let detectTimeout = null;
      let currentDetection = null;

      urlInput.addEventListener("input", () => {
        const url = urlInput.value.trim();
        clearTimeout(detectTimeout);

        if (!url) {
          sendBtn.disabled = true;
          detectHint.classList.remove("ready");
          detectText.textContent = "Paste a URL to detect type";
          inputIcon.setAttribute("data-lucide", "link");
          lucide.createIcons();
          updatePreview(null);
          return;
        }

        sendBtn.disabled = false;
        detectText.textContent = "Detecting...";

        detectTimeout = setTimeout(async () => {
          try {
            const r = await fetch(`/api/detect?url=${encodeURIComponent(url)}`);
            const d = await r.json();
            currentDetection = d;

            inputIcon.setAttribute("data-lucide", d.icon || "link");
            lucide.createIcons();

            detectHint.classList.add("ready");
            let text = "";
            if (d.site) text = `<span class="site-badge">${d.site}</span> `;
            if (d.title) text += d.title;
            else if (d.type === "torrent") text += "Torrent stream";
            else if (d.type === "video") text += "Direct video";
            else if (d.type === "stream") text += "HLS stream";
            else if (d.type === "youtube") text += "YouTube video";
            else text += "Website";

            detectText.innerHTML = text;
            updatePreview(url, d);
          } catch (e) {
            detectText.textContent = "Unknown URL type";
            currentDetection = { type: "website", method: "iframe" };
          }
        }, 300);
      });

      function updatePreview(url, detection) {
        if (!url) {
          preview.innerHTML =
            '<div class="preview-placeholder"><i data-lucide="film"></i><span>No media</span></div>';
          lucide.createIcons();
          return;
        }

        const lower = url.toLowerCase();

        if (detection?.thumbnail) {
          preview.innerHTML = `<img src="${detection.thumbnail}" alt="thumbnail">`;
        } else if (lower.endsWith(".mp4") || lower.endsWith(".webm")) {
          preview.innerHTML = `<video src="${url}" controls muted></video>`;
        } else if (/youtube|youtu\.be/.test(lower)) {
          const id = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/)?.[1];
          if (id)
            preview.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}" allowfullscreen></iframe>`;
        } else if (detection?.type === "torrent") {
          preview.innerHTML =
            '<div class="preview-placeholder"><i data-lucide="download"></i><span>Torrent</span></div>';
          lucide.createIcons();
        } else {
          preview.innerHTML =
            '<div class="preview-placeholder"><i data-lucide="globe"></i><span>Website</span></div>';
          lucide.createIcons();
        }
      }

      // Send to TV
      sendBtn.addEventListener("click", sendToTv);
      urlInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendToTv();
      });

      async function sendToTv() {
        const url = urlInput.value.trim();
        if (!url) return;

        status.className = "status";
        status.textContent = "Processing...";

        try {
          let urlToSend = url;
          let title = currentDetection?.title || url;
          let site = currentDetection?.site || "";
          let icon = currentDetection?.icon || "link";

          // For yt-dlp supported sites, create HLS stream
          if (currentDetection?.method === "yt-dlp") {
            status.textContent = "Creating stream via yt-dlp...";
            const r = await fetch("/api/url2hls", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ url }),
            });
            const d = await r.json();
            if (d.error) throw new Error(d.error);
            urlToSend = d.streamUrl;
            title = d.name || title;
          }
          // For torrents, use existing torrent2mp4
          else if (
            currentDetection?.type === "torrent" ||
            url.startsWith("magnet:") ||
            url.toLowerCase().endsWith(".torrent")
          ) {
            status.textContent = "Creating torrent stream...";
            const r = await fetch("/api/torrent2mp4", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ url }),
            });
            const d = await r.json();
            if (d.error) throw new Error(d.error);
            urlToSend =
              d.streamUrl || `/hls/${encodeURIComponent(d.streamId)}.m3u8`;
            title = d.name || title;
            icon = "download";
          }

          // Push to TV
          status.textContent = "Sending to TV...";
          const pushRes = await fetch("/tv/push", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url: urlToSend }),
          });
          const pushData = await pushRes.json();

          if (pushData.success) {
            status.className = "status success";
            status.textContent = `Sent to ${pushData.clients} TV(s): ${title}`;
            addToHistory(url, title, site, icon);
          } else {
            throw new Error(pushData.error || "Failed to send");
          }
        } catch (e) {
          status.className = "status error";
          status.textContent = "Error: " + e.message;
        }
      }

      // Play here
      $("playHereBtn").addEventListener("click", () => {
        const url = urlInput.value.trim();
        if (url) location.href = `/player.html?url=${encodeURIComponent(url)}`;
      });

      // Copy link
      $("copyLinkBtn").addEventListener("click", async () => {
        const url = urlInput.value.trim();
        if (!url) return;
        const shareUrl = `${location.origin}/player.html?url=${encodeURIComponent(url)}`;
        await navigator.clipboard.writeText(shareUrl);
        status.textContent = "Link copied!";
      });

      // Clear TV
      $("clearTvBtn").addEventListener("click", async () => {
        await fetch("/tv/clear", { method: "POST" });
        status.textContent = "TV cleared";
      });

      // Drag & drop for torrent files
      document.addEventListener("dragenter", (e) => {
        e.preventDefault();
        if (e.dataTransfer.types.includes("Files")) {
          dropZone.classList.add("active");
        }
      });
      dropZone.addEventListener("dragleave", (e) => {
        if (e.target === dropZone) dropZone.classList.remove("active");
      });
      dropZone.addEventListener("dragover", (e) => e.preventDefault());
      dropZone.addEventListener("drop", async (e) => {
        e.preventDefault();
        dropZone.classList.remove("active");

        const file = e.dataTransfer.files[0];
        if (!file || !file.name.endsWith(".torrent")) {
          status.textContent = "Only .torrent files supported";
          return;
        }

        status.textContent = "Uploading torrent...";

        // Read file and convert to base64 data URI for processing
        const reader = new FileReader();
        reader.onload = async () => {
          // For now, we can't directly upload - user needs to use magnet or URL
          // Show file name and suggest using magnet link
          status.textContent = `Torrent: ${file.name} - Please use magnet link or torrent URL instead`;
        };
        reader.readAsDataURL(file);
      });
    </script>
  </body>
</html>
